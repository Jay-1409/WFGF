{"files":[{"id":"3c86684e-2606-4bc6-8723-b68b0ca32438","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Kolkata\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_ACCESSING\",\n    \"access\": \"ANYONE\"\n  }\n}"},{"id":"776c2b78-49a5-4889-8c56-f027badfb7c9","name":"Code","type":"server_js","source":"// Extract Sheet ID from full URL\nfunction extractSheetId(url) {\n  const match \u003d url.match(/\\/d\\/([a-zA-Z0-9-_]+)/);\n  if (match \u0026\u0026 match[1]) return match[1];\n  throw new Error(\"Invalid Google Sheet URL\");\n}\n\n// Handles GET request to serve your HTML page\nfunction doGet() {\n  const template \u003d HtmlService.createTemplateFromFile(\u0027page\u0027);\n  // Inject the deployment URL dynamically:\n  template.deploymentUrl \u003d ScriptApp.getService().getUrl();\n  return template.evaluate();\n}\n\n\n// Handles POST request to setup webhook forwarding\nfunction setupForwarding(sheetUrl, webhookUrl) {\n  try {\n    const sheetId \u003d extractSheetId(sheetUrl);\n    PropertiesService.getScriptProperties().setProperties({\n      SHEET_ID: sheetId,\n      WEBHOOK_URL: webhookUrl\n    });\n\n    installFormTrigger(sheetId);\n    return \"Trigger installed successfully!\";\n  } catch (err) {\n    throw new Error(\"Setup failed: \" + err.message);\n  }\n}\n\nfunction extractSheetId(url) {\n  const match \u003d url.match(/\\/d\\/([a-zA-Z0-9-_]+)/);\n  if (!match || !match[1]) throw new Error(\"Invalid Google Sheet URL\");\n  return match[1];\n}\n\nfunction installFormTrigger(sheetId) {\n  const ss \u003d SpreadsheetApp.openById(sheetId);\n  ScriptApp.newTrigger(\"onDynamicFormSubmit\")\n    .forSpreadsheet(ss)\n    .onFormSubmit()\n    .create();\n}\n\n\n// Deletes existing triggers for onDynamicFormSubmit to avoid duplicates\nfunction deleteExistingTriggers() {\n  const triggers \u003d ScriptApp.getProjectTriggers();\n  for (const trig of triggers) {\n    if (trig.getHandlerFunction() \u003d\u003d\u003d \"onDynamicFormSubmit\") {\n      ScriptApp.deleteTrigger(trig);\n    }\n  }\n}\n\n// Installs the form submit trigger using stored sheet ID\nfunction installFormTriggerFromProps() {\n  const props \u003d PropertiesService.getScriptProperties();\n  const sheetId \u003d props.getProperty(\"SHEET_ID\");\n\n  if (!sheetId) {\n    throw new Error(\"SHEET_ID not set.\");\n  }\n\n  // Remove existing onDynamicFormSubmit triggers first\n  const triggers \u003d ScriptApp.getProjectTriggers();\n  for (const trig of triggers) {\n    if (trig.getHandlerFunction() \u003d\u003d\u003d \"onDynamicFormSubmit\") {\n      ScriptApp.deleteTrigger(trig);\n    }\n  }\n\n  const ss \u003d SpreadsheetApp.openById(sheetId);\n\n  ScriptApp.newTrigger(\"onDynamicFormSubmit\")\n    .forSpreadsheet(ss)\n    .onFormSubmit()\n    .create();\n\n  Logger.log(\"Trigger installed for spreadsheet ID: \" + sheetId);\n}\n\n\n// Triggered when the linked form is submitted\nfunction onDynamicFormSubmit(e) {\n  const props \u003d PropertiesService.getScriptProperties();\n  const sheetId \u003d props.getProperty(\"SHEET_ID\");\n  const webhookUrl \u003d props.getProperty(\"WEBHOOK_URL\");\n\n  if (!sheetId || !webhookUrl) {\n    Logger.log(\"Missing configuration: sheet ID or webhook URL\");\n    return;\n  }\n\n  try {\n    const ss \u003d SpreadsheetApp.openById(sheetId);\n    Logger.log(\"✅ Sheet opened successfully: \" + ss.getName());\n    const sheet \u003d ss.getSheets()[0];\n    const headers \u003d sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];\n    const lastRow \u003d sheet.getLastRow();\n    const rowData \u003d sheet.getRange(lastRow, 1, 1, headers.length).getValues()[0];\n\n    const cleanedRow \u003d rowData.map(clean);\n    const dataToSend \u003d {};\n    headers.forEach((key, i) \u003d\u003e {\n      dataToSend[key] \u003d cleanedRow[i];\n    });\n\n    sendToWebhook(dataToSend, webhookUrl);\n  } catch (err) {\n    Logger.log(\"❌ Failed in onDynamicFormSubmit: \" + err.message);\n  }\n}\n\n// Cleans each value before sending\nfunction clean(val) {\n  return String(val)\n    .replace(/Object/g, \u0027\u0027)\n    .replace(/\\n/g, \u0027\u0027)\n    .replace(/\\s+/g, \u0027 \u0027)\n    .trim();\n}\n\n// Sends the data to the webhook endpoint\nfunction sendToWebhook(payload, webhookUrl) {\n  const formData \u003d Object.entries(payload)\n    .map(([key, val]) \u003d\u003e `${encodeURIComponent(key)}\u003d${encodeURIComponent(val)}`)\n    .join(\"\u0026\");\n\n  const options \u003d {\n    method: \"post\",\n    contentType: \"application/x-www-form-urlencoded\",\n    payload: formData\n  };\n\n  try {\n    const response \u003d UrlFetchApp.fetch(webhookUrl, options);\n    Logger.log(\"✅ Webhook sent! Status: \" + response.getResponseCode());\n  } catch (err) {\n    Logger.log(\"❌ Webhook error: \" + err);\n  }\n}\n\n// Optional test function to verify sheet access manually\nfunction testSheetOpen() {\n  const sheetId \u003d \"1kYREngDJeo9OFGKNHlc36CGYpk9vaCRjMkyQjs0VuIY\";  // replace with your sheet ID\n  try {\n    const ss \u003d SpreadsheetApp.openById(sheetId);\n    Logger.log(\"✅ Sheet opened: \" + ss.getName());\n  } catch (err) {\n    Logger.log(\"❌ ERROR: \" + err.message);\n  }\n}\n"},{"id":"0e0e4913-3d30-426d-a225-271d85bff890","name":"page","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta charset\u003d\"UTF-8\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"\u003e\n  \u003ctitle\u003eWebhook Setup\u003c/title\u003e\n  \u003cstyle\u003e\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n\n    body {\n      font-family: \u0027Segoe UI\u0027, Tahoma, Geneva, Verdana, sans-serif;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      min-height: 100vh;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 20px;\n    }\n\n    .container {\n      background: rgba(255, 255, 255, 0.95);\n      backdrop-filter: blur(10px);\n      border-radius: 20px;\n      padding: 40px;\n      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);\n      max-width: 500px;\n      width: 100%;\n      position: relative;\n      overflow: hidden;\n    }\n\n    .container::before {\n      content: \u0027\u0027;\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      height: 4px;\n      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);\n      background-size: 400% 400%;\n      animation: gradient 3s ease infinite;\n    }\n\n    @keyframes gradient {\n      0%, 100% { background-position: 0% 50%; }\n      50% { background-position: 100% 50%; }\n    }\n\n    .header {\n      text-align: center;\n      margin-bottom: 30px;\n    }\n\n    .icon {\n      width: 60px;\n      height: 60px;\n      background: linear-gradient(135deg, #667eea, #764ba2);\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      margin: 0 auto 20px;\n      position: relative;\n      animation: pulse 2s infinite;\n    }\n\n    @keyframes pulse {\n      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }\n      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }\n      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }\n    }\n\n    .icon svg {\n      width: 30px;\n      height: 30px;\n      fill: white;\n    }\n\n    h1 {\n      color: #333;\n      font-size: 28px;\n      font-weight: 700;\n      margin-bottom: 8px;\n    }\n\n    .subtitle {\n      color: #666;\n      font-size: 16px;\n      margin-bottom: 20px;\n    }\n\n    .form-group {\n      margin-bottom: 25px;\n      position: relative;\n    }\n\n    .form-group label {\n      display: block;\n      color: #333;\n      font-weight: 600;\n      margin-bottom: 8px;\n      font-size: 14px;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n\n    .input-container {\n      position: relative;\n    }\n\n    .input-container::before {\n      content: \u0027\u0027;\n      position: absolute;\n      left: 15px;\n      top: 50%;\n      transform: translateY(-50%);\n      width: 20px;\n      height: 20px;\n      background-size: contain;\n      background-repeat: no-repeat;\n      opacity: 0.6;\n    }\n\n    .sheet-input::before {\n      background-image: url(\u0027data:image/svg+xml;utf8,\u003csvg xmlns\u003d\"http://www.w3.org/2000/svg\" viewBox\u003d\"0 0 24 24\" fill\u003d\"%23667eea\"\u003e\u003cpath d\u003d\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/\u003e\u003c/svg\u003e\u0027);\n    }\n\n    .webhook-input::before {\n      background-image: url(\u0027data:image/svg+xml;utf8,\u003csvg xmlns\u003d\"http://www.w3.org/2000/svg\" viewBox\u003d\"0 0 24 24\" fill\u003d\"%23667eea\"\u003e\u003cpath d\u003d\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"/\u003e\u003c/svg\u003e\u0027);\n    }\n\n    input[type\u003d\"text\"] {\n      width: 100%;\n      padding: 15px 15px 15px 50px;\n      border: 2px solid #e1e8ed;\n      border-radius: 12px;\n      font-size: 16px;\n      transition: all 0.3s ease;\n      background: rgba(255, 255, 255, 0.9);\n    }\n\n    input[type\u003d\"text\"]:focus {\n      outline: none;\n      border-color: #667eea;\n      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n      transform: translateY(-2px);\n    }\n\n    .submit-btn {\n      width: 100%;\n      padding: 16px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      border: none;\n      border-radius: 12px;\n      font-size: 18px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.3s ease;\n      text-transform: uppercase;\n      letter-spacing: 1px;\n      position: relative;\n      overflow: hidden;\n    }\n\n    .submit-btn::before {\n      content: \u0027\u0027;\n      position: absolute;\n      top: 0;\n      left: -100%;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n      transition: left 0.5s;\n    }\n\n    .submit-btn:hover::before {\n      left: 100%;\n    }\n\n    .submit-btn:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);\n    }\n\n    .submit-btn:active {\n      transform: translateY(0);\n    }\n\n    .loading {\n      pointer-events: none;\n      opacity: 0.7;\n    }\n\n    .loading::after {\n      content: \u0027\u0027;\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      width: 20px;\n      height: 20px;\n      border: 2px solid rgba(255, 255, 255, 0.3);\n      border-top: 2px solid white;\n      border-radius: 50%;\n      animation: spin 1s linear infinite;\n    }\n\n    @keyframes spin {\n      0% { transform: translate(-50%, -50%) rotate(0deg); }\n      100% { transform: translate(-50%, -50%) rotate(360deg); }\n    }\n\n    .success-message {\n      background: linear-gradient(135deg, #4CAF50, #45a049);\n      color: white;\n      padding: 15px;\n      border-radius: 12px;\n      margin-top: 20px;\n      display: none;\n      align-items: center;\n      gap: 10px;\n      animation: slideIn 0.5s ease;\n    }\n\n    .error-message {\n      background: linear-gradient(135deg, #f44336, #da190b);\n      color: white;\n      padding: 15px;\n      border-radius: 12px;\n      margin-top: 20px;\n      display: none;\n      align-items: center;\n      gap: 10px;\n      animation: slideIn 0.5s ease;\n    }\n\n    @keyframes slideIn {\n      from { transform: translateY(-20px); opacity: 0; }\n      to { transform: translateY(0); opacity: 1; }\n    }\n\n    .floating-elements {\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      pointer-events: none;\n      overflow: hidden;\n    }\n\n    .floating-elements::before,\n    .floating-elements::after {\n      content: \u0027\u0027;\n      position: absolute;\n      background: rgba(255, 255, 255, 0.1);\n      border-radius: 50%;\n      animation: float 6s ease-in-out infinite;\n    }\n\n    .floating-elements::before {\n      width: 60px;\n      height: 60px;\n      top: 20%;\n      left: 10%;\n      animation-delay: -2s;\n    }\n\n    .floating-elements::after {\n      width: 40px;\n      height: 40px;\n      bottom: 20%;\n      right: 10%;\n      animation-delay: -4s;\n    }\n\n    @keyframes float {\n      0%, 100% { transform: translateY(0px) rotate(0deg); }\n      50% { transform: translateY(-20px) rotate(180deg); }\n    }\n\n    @media (max-width: 480px) {\n      .container {\n        padding: 30px 20px;\n        margin: 10px;\n      }\n      \n      h1 {\n        font-size: 24px;\n      }\n      \n      .subtitle {\n        font-size: 14px;\n      }\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cdiv class\u003d\"container\"\u003e\n    \u003cdiv class\u003d\"floating-elements\"\u003e\u003c/div\u003e\n    \n    \u003cdiv class\u003d\"header\"\u003e\n      \u003cdiv class\u003d\"icon\"\u003e\n        \u003csvg viewBox\u003d\"0 0 24 24\"\u003e\n          \u003cpath d\u003d\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"/\u003e\n        \u003c/svg\u003e\n      \u003c/div\u003e\n      \u003ch1\u003eWebhook Setup\u003c/h1\u003e\n      \u003cp class\u003d\"subtitle\"\u003eConnect your Google Sheets to external services\u003c/p\u003e\n    \u003c/div\u003e\n\n    \u003cform id\u003d\"setupForm\"\u003e\n      \u003cdiv class\u003d\"form-group\"\u003e\n        \u003clabel for\u003d\"sheetUrl\"\u003eGoogle Sheet URL\u003c/label\u003e\n        \u003cdiv class\u003d\"input-container sheet-input\"\u003e\n          \u003cinput type\u003d\"text\" id\u003d\"sheetUrl\" name\u003d\"sheetUrl\" placeholder\u003d\"https://docs.google.com/spreadsheets/d/...\" required\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cdiv class\u003d\"form-group\"\u003e\n        \u003clabel for\u003d\"webhookUrl\"\u003eWebhook URL\u003c/label\u003e\n        \u003cdiv class\u003d\"input-container webhook-input\"\u003e\n          \u003cinput type\u003d\"text\" id\u003d\"webhookUrl\" name\u003d\"webhookUrl\" placeholder\u003d\"https://your-webhook-endpoint.com/...\" required\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n\n      \u003cbutton type\u003d\"submit\" class\u003d\"submit-btn\" id\u003d\"submitBtn\"\u003e\n        \u003cspan class\u003d\"btn-text\"\u003eActivate Integration\u003c/span\u003e\n      \u003c/button\u003e\n    \u003c/form\u003e\n\n    \u003cdiv class\u003d\"success-message\" id\u003d\"successMessage\"\u003e\n      \u003csvg width\u003d\"20\" height\u003d\"20\" viewBox\u003d\"0 0 24 24\" fill\u003d\"currentColor\"\u003e\n        \u003cpath d\u003d\"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z\"/\u003e\n      \u003c/svg\u003e\n      \u003cspan id\u003d\"successText\"\u003e\u003c/span\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"error-message\" id\u003d\"errorMessage\"\u003e\n      \u003csvg width\u003d\"20\" height\u003d\"20\" viewBox\u003d\"0 0 24 24\" fill\u003d\"currentColor\"\u003e\n        \u003cpath d\u003d\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/\u003e\n      \u003c/svg\u003e\n      \u003cspan id\u003d\"errorText\"\u003e\u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cscript\u003e\n    const form \u003d document.getElementById(\"setupForm\");\n    const submitBtn \u003d document.getElementById(\"submitBtn\");\n    const successMessage \u003d document.getElementById(\"successMessage\");\n    const errorMessage \u003d document.getElementById(\"errorMessage\");\n    const successText \u003d document.getElementById(\"successText\");\n    const errorText \u003d document.getElementById(\"errorText\");\n\n    function showMessage(isSuccess, message) {\n      // Hide both messages first\n      successMessage.style.display \u003d \u0027none\u0027;\n      errorMessage.style.display \u003d \u0027none\u0027;\n      \n      // Show the appropriate message\n      if (isSuccess) {\n        successText.textContent \u003d message;\n        successMessage.style.display \u003d \u0027flex\u0027;\n      } else {\n        errorText.textContent \u003d message;\n        errorMessage.style.display \u003d \u0027flex\u0027;\n      }\n      \n      // Auto-hide after 5 seconds\n      setTimeout(() \u003d\u003e {\n        successMessage.style.display \u003d \u0027none\u0027;\n        errorMessage.style.display \u003d \u0027none\u0027;\n      }, 5000);\n    }\n\n    form.onsubmit \u003d function (e) {\n      e.preventDefault();\n\n      const sheetUrl \u003d form.sheetUrl.value;\n      const webhookUrl \u003d form.webhookUrl.value;\n\n      // Add loading state\n      submitBtn.classList.add(\u0027loading\u0027);\n      submitBtn.querySelector(\u0027.btn-text\u0027).textContent \u003d \u0027Activating...\u0027;\n\n      // Hide previous messages\n      successMessage.style.display \u003d \u0027none\u0027;\n      errorMessage.style.display \u003d \u0027none\u0027;\n\n      // Simulate the Google Apps Script call\n      // In the actual implementation, this would call google.script.run\n      if (typeof google !\u003d\u003d \u0027undefined\u0027 \u0026\u0026 google.script \u0026\u0026 google.script.run) {\n        google.script.run\n          .withSuccessHandler(msg \u003d\u003e {\n            submitBtn.classList.remove(\u0027loading\u0027);\n            submitBtn.querySelector(\u0027.btn-text\u0027).textContent \u003d \u0027Activate Integration\u0027;\n            showMessage(true, msg);\n          })\n          .withFailureHandler(err \u003d\u003e {\n            submitBtn.classList.remove(\u0027loading\u0027);\n            submitBtn.querySelector(\u0027.btn-text\u0027).textContent \u003d \u0027Activate Integration\u0027;\n            showMessage(false, err.message || \u0027An error occurred\u0027);\n          })\n          .setupForwarding(sheetUrl, webhookUrl);\n      } else {\n        // Fallback for demonstration\n        setTimeout(() \u003d\u003e {\n          submitBtn.classList.remove(\u0027loading\u0027);\n          submitBtn.querySelector(\u0027.btn-text\u0027).textContent \u003d \u0027Activate Integration\u0027;\n          showMessage(true, \u0027Webhook integration activated successfully!\u0027);\n        }, 2000);\n      }\n    };\n\n    // Add input validation and visual feedback\n    const inputs \u003d document.querySelectorAll(\u0027input[type\u003d\"text\"]\u0027);\n    inputs.forEach(input \u003d\u003e {\n      input.addEventListener(\u0027input\u0027, function() {\n        this.style.borderColor \u003d this.value ? \u0027#667eea\u0027 : \u0027#e1e8ed\u0027;\n      });\n    });\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e"},{"id":"54407704-d337-4c9a-899a-211f2d72eb9f","name":"TestTrig","type":"server_js","source":"function testWebhookSend() {\n  const testPayload \u003d {\n    name: \"Jay\",\n    email: \"jay@example.com\",\n    message: \"This is a test submission\"\n  };\n\n  const formData \u003d Object.entries(testPayload)\n    .map(([key, val]) \u003d\u003e `${encodeURIComponent(key)}\u003d${encodeURIComponent(val)}`)\n    .join(\"\u0026\");\n\n  const options \u003d {\n    method: \"post\",\n    contentType: \"application/x-www-form-urlencoded\",\n    payload: formData\n  };\n\n  const endpoint \u003d \"https://wfgf.vercel.app/api/tinyhook\"; // 🔁 replace this!\n\n  try {\n    const response \u003d UrlFetchApp.fetch(endpoint, options);\n    Logger.log(\"✅ Status: \" + response.getResponseCode());\n    Logger.log(\"🔁 Response: \" + response.getContentText());\n  } catch (err) {\n    Logger.log(\"❌ Error: \" + err.message);\n  }\n}\n"}]}